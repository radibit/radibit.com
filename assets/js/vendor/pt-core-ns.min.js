
/* Licensed under the Apache License, Version 2.0. (http://www.apache.org/licenses/LICENSE-2.0). Copyright 2015-2016 William Ngan. (https://github.com/williamngan/pt/) */

window.Pt={},function(){var t,e,i,n,s,r,o,h,u,c,p,l,y,f,d,m,g,x,v,z,_,b,w,M=function(t,e){return function(){return t.apply(e,arguments)}},D=function(t,e){function i(){this.constructor=t}for(var n in e)$.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},$={}.hasOwnProperty,L=[].slice;n=function(){function t(){}return t.xy="xy",t.yz="yz",t.xz="xz",t.xyz="xyz",t.identical=-1,t.right=3,t.bottom_right=4,t.bottom=5,t.bottom_left=6,t.left=7,t.top_left=0,t.top=1,t.top_right=2,t.sideLabels=["identical","right","bottom right","bottom","bottom left","left","top left","top","top right"],t.epsilon=1e-4,t.pi=Math.PI,t.two_pi=6.283185307179586,t.half_pi=1.5707963267948966,t.quarter_pi=.7853981633974483,t.one_degree=.017453292519943295,t.rad_to_deg=57.29577951308232,t.deg_to_rad=.017453292519943295,t.gravity=9.81,t.newton=.10197,t.gaussian=.3989422804014327,t}(),this.Const=n,c=function(){function t(){}return t.rotateAnchor2D=function(t,e,i){var s,r,o;return null==i&&(i=n.xy),s=e.get2D(i),r=Math.cos(t),o=Math.sin(t),[r,o,0,-o,r,0,s.x*(1-r)+s.y*o,s.y*(1-r)-s.x*o,1]},t.reflectAnchor2D=function(t,e){var i,s,r,o;return null==e&&(e=n.xy),r=t.intercept(e),i=2*Math.atan(r.slope),s=Math.cos(i),o=Math.sin(i),[s,o,0,o,-s,0,-r.yi*o,r.yi+r.yi*s,1]},t.shearAnchor2D=function(t,e,i,s){var r,o,h;return null==s&&(s=n.xy),r=i.get2D(s),o=Math.tan(t),h=Math.tan(e),[1,o,0,h,1,0,-r.y*h,-r.x*o,1]},t.scaleAnchor2D=function(t,e,i,s){var r;return null==s&&(s=n.xy),r=i.get2D(s),[t,0,0,0,e,0,-r.x*t+r.x,-r.y*e+r.y,1]},t.scale2D=function(t,e){return[t,0,0,0,e,0,0,0,1]},t.shear2D=function(t,e){return[1,Math.tan(t),0,Math.tan(e),1,0,0,0,1]},t.rotate2D=function(t,e){return[t,e,0,-e,t,0,0,0,1]},t.translate2D=function(t,e){return[1,0,0,0,1,0,t,e,1]},t.transform2D=function(t,e,i,s){var r,o,h;return null==i&&(i=n.xy),null==s&&(s=!1),r=t.get2D(i),o=r.x*e[0]+r.y*e[3]+e[6],h=r.x*e[1]+r.y*e[4]+e[7],r.x=o,r.y=h,r=r.get2D(i,!0),s?r:(t.set(r),t)},t}(),this.Matrix=c,b=function(){function t(){}return t.toRadian=function(t){return t*n.deg_to_rad},t.toDegree=function(t){return t*n.rad_to_deg},t.toHexColor=function(t){var e;return e=Math.floor(t).toString(16),1===e.length?"0"+e:e},t.toRGBColor=function(t,e,i){var n,s,r;return null==e&&(e=!1),null==i&&(i=1),"#"===t[0]&&(t=t.substr(1)),3===t.length?(r=parseInt(t[0]+t[0],16),s=parseInt(t[1]+t[1],16),n=parseInt(t[2]+t[2],16)):t.length>=6?(r=parseInt(t[0]+t[1],16),s=parseInt(t[2]+t[3],16),n=parseInt(t[4]+t[5],16)):(r=0,s=0,n=0),e?"rgba("+r+","+s+","+n+","+i+")":[r,s,n,i]},t.bound=function(t,e,i){var n,s;return null==i&&(i=!1),n=t%e,s=e/2,n>s?n-=e:-s>n&&(n+=e),i&&0>n?n+e:n},t.boundAngle=function(e,i){return t.bound(e,360,i)},t.boundRadian=function(e,i){return t.bound(e,n.two_pi,i)},t.boundingBox=function(t,e){var i,n,s,r,o;for(null==e&&(e=!1),r=new f(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),s=new f(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),i=0,n=t.length;n>i;i++)o=t[i],o.x<r.x&&(r.x=o.x),o.y<r.y&&(r.y=o.y),o.x>s.x&&(s.x=o.x),o.y>s.y&&(s.y=o.y),e&&(o.z<r.z&&(r.z=o.z),o.z>s.z&&(s.z=o.z));return new m(r).to(s)},t.lerp=function(t,e,i){return(1-i)*t+i*e},t.centroid=function(t){var e,i,n,s;for(e=new w,i=0,n=t.length;n>i;i++)s=t[i],e.add(s);return e.divide(t.length)},t.same=function(t,e,i){return null==i&&(i=n.epsilon),Math.abs(t-e)<i},t.within=function(t,e,i){return t>=Math.min(e,i)&&t<=Math.max(e,i)},t.randomRange=function(t,e){var i;return null==e&&(e=0),i=t>e?t-e:e-t,t+Math.random()*i},t.mixin=function(t,e){var i,n;for(i in e)n=e[i],e.hasOwnProperty(i)&&(t.prototype[i]=e[i]);return t},t.extend=function(t,e){return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t},t.clonePoints=function(t){var e,i,n,s;for(s=[],e=0,i=t.length;i>e;e++)n=t[e],s.push(n.clone());return s},t.contextRotateOrigin=function(t,e,i,n,s){var r,h;return null==n&&(n=!1),h=e.size(),n||(n=h.$multiply(.5),n.add(e)),s&&(r=s.size(),o.rect(t,s),t.clip()),t.translate(n.x,n.y),t.rotate(i),t.translate(-n.x,-n.y)},t.sinCosTable=function(){var t,e,i,n;for(t=[],n=[],e=i=0;360>=i;e=i+=1)t[e]=Math.cos(e*Math.PI/180),n[e]=Math.sin(e*Math.PI/180);return{sin:n,cos:t}},t.chance=function(t){return Math.random()<t},t.gaussian=function(t,e,i){return null==e&&(e=0),null==i&&(i=1),t=(t-e)/i,n.gaussian*Math.exp(-.5*t*t)/i},t.mapToRange=function(t,e,i,n,s){if(e===i)throw"[min1, max1] must be a non-degenerate interval (that is, min1 != max1)";return(t-e)/(i-e)*(s-n)+n},t}(),this.Util=b,z=function(){function t(t){null==t&&(t=1e3),this.duration=t,this._time=0,this._ease=function(t,e,i,n){return t/n},this._intervalID=-1}return t.prototype.start=function(t){var e;return e=Math.min(Date.now()-this._time,this.duration),t||e>=this.duration?this._time=Date.now():void 0},t.prototype.setEasing=function(t){return this._ease=t},t.prototype.check=function(){var t;return t=Math.min(Date.now()-this._time,this.duration),this._ease(t,0,1,this.duration)},t.prototype.track=function(t){var e;return clearInterval(this._intervalID),this.start(!0),e=this,this._intervalID=setInterval(function(){var i;return i=e.check(),t(i),i>=1?clearInterval(e._intervalID):void 0},25),this._intervalID},t}(),this.Timer=z,v=function(){function t(t){if("string"!=typeof t||0===t.length)throw"id parameter is not valid";this.id=t,this.size=new w,this.center=new w,this._timePrev=0,this._timeDiff=0,this._timeEnd=-1,this.items={},this._animID=-1,this._animCount=0,this._animPause=!1,this._refresh=!0}return t.prototype.refresh=function(t){return this._refresh=t,this},t.prototype.render=function(t){return this},t.prototype.resize=function(t,e){},t.prototype.clear=function(){},t.prototype.add=function(t){var e;if(null==t.animate||"function"!=typeof t.animate)throw"a player object for Space.add must define animate()";return e=this._animCount++,this.items[e]=t,t.animateID=e,null!=t.onSpaceResize&&t.onSpaceResize(this.size.x,this.size.y),this},t.prototype.remove=function(t){return delete this.items[t.animateID],this},t.prototype.removeAll=function(){return this.items={},this},t.prototype.play=function(t){var e;if(null==t&&(t=0),this._animID=requestAnimationFrame(function(t){return function(e){return t.play(e)}}(this)),!this._animPause){this._timeDiff=t-this._timePrev;try{this._playItems(t)}catch(i){throw e=i,cancelAnimationFrame(this._animID),console.error(e.stack),e}return this._timePrev=t,this}},t.prototype._playItems=function(t){var e,i,n;this._refresh&&this.clear(),i=this.items;for(e in i)n=i[e],n.animate(t,this._timeDiff,this.ctx);return this._timeEnd>=0&&t>this._timeEnd&&cancelAnimationFrame(this._animID),this},t.prototype.pause=function(t){return null==t&&(t=!1),this._animPause=t?!this._animPause:!0,this},t.prototype.resume=function(){return this._animPause=!1,this},t.prototype.stop=function(t){return null==t&&(t=0),this._timeEnd=t,this},t.prototype.playTime=function(t){return null==t&&(t=5e3),this.play(),this.stop(t)},t.prototype.bindCanvas=function(t,e){return this.space.addEventListener?this.space.addEventListener(t,e):void 0},t.prototype.bindMouse=function(t){return null==t&&(t=!0),this.space.addEventListener&&this.space.removeEventListener?t?(this.space.addEventListener("mousedown",this._mouseDown.bind(this)),this.space.addEventListener("mouseup",this._mouseUp.bind(this)),this.space.addEventListener("mouseover",this._mouseOver.bind(this)),this.space.addEventListener("mouseout",this._mouseOut.bind(this)),this.space.addEventListener("mousemove",this._mouseMove.bind(this))):(this.space.removeEventListener("mousedown",this._mouseDown.bind(this)),this.space.removeEventListener("mouseup",this._mouseUp.bind(this)),this.space.removeEventListener("mouseover",this._mouseOver.bind(this)),this.space.removeEventListener("mouseout",this._mouseOut.bind(this)),this.space.removeEventListener("mousemove",this._mouseMove.bind(this))):void 0},t.prototype.bindTouch=function(t){return null==t&&(t=!0),this.space.addEventListener&&this.space.removeEventListener?t?(this.space.addEventListener("touchstart",this._mouseDown.bind(this)),this.space.addEventListener("touchend",this._mouseUp.bind(this)),this.space.addEventListener("touchmove",function(t){return function(e){return e.preventDefault(),t._mouseMove(e)}}(this)),this.space.addEventListener("touchcancel",this._mouseOut.bind(this))):(this.space.removeEventListener("touchstart",this._mouseDown.bind(this)),this.space.removeEventListener("touchend",this._mouseUp.bind(this)),this.space.removeEventListener("touchmove",this._mouseMove.bind(this)),this.space.removeEventListener("touchcancel",this._mouseOut.bind(this))):void 0},t.prototype.touchesToPoints=function(t,e){var i;return null==e&&(e="touches"),t&&t[e]?function(){var n,s,r,o;for(r=t[e],o=[],n=0,s=r.length;s>n;n++)i=r[n],o.push(new w(i.pageX-this.boundRect.left,i.pageY-this.boundRect.top));return o}.call(this):[]},t.prototype._mouseAction=function(t,e){var i,n,s,r,o,h,u,a,c;if(e.touches||e.changedTouches){o=this.items,u=[];for(n in o)c=o[n],null!=c.onTouchAction?(i=e.changedTouches&&e.changedTouches.length>0,s=i?e.changedTouches.item(0).pageX:0,r=i?e.changedTouches.item(0).pageY:0,u.push(c.onTouchAction(t,s,r,e))):u.push(void 0);return u}h=this.items,a=[];for(n in h)c=h[n],null!=c.onMouseAction?(s=e.offsetX||e.layerX,r=e.offsetY||e.layerY,a.push(c.onMouseAction(t,s,r,e))):a.push(void 0);return a},t.prototype._mouseDown=function(t){return this._mouseAction("down",t),this._mdown=!0},t.prototype._mouseUp=function(t){return this._mouseAction("up",t),this._mdrag&&this._mouseAction("drop",t),this._mdown=!1,this._mdrag=!1},t.prototype._mouseMove=function(t){return this._mouseAction("move",t),this._mdown?(this._mdrag=!0,this._mouseAction("drag",t)):void 0},t.prototype._mouseOver=function(t){return this._mouseAction("over",t)},t.prototype._mouseOut=function(t){return this._mouseAction("out",t),this._mdrag&&this._mouseAction("drop",t),this._mdrag=!1},t}(),this.Space=v,t=function(t){function e(t,i){this._resizeHandler=M(this._resizeHandler,this);var n,s,r,o;t||(t="pt"),o=t instanceof Element,e.__super__.constructor.call(this,o?"pt_custom_space":t),this.space=null,this.bound=null,this.boundRect={top:0,left:0,width:0,height:0},this.pixelScale=1,this._autoResize=!0,s=null,o?s=t:(this.id="#"===this.id[0]?this.id.substr(1):this.id,s=document.querySelector("#"+this.id),n=!0),s?"canvas"!==s.nodeName.toLowerCase()?(this.bound=s,this.space=this._createElement("canvas",this.id+"_canvas"),this.bound.appendChild(this.space)):(this.space=s,this.bound=this.space.parentElement):(this.bound=this._createElement("div",this.id+"_container"),this.space=this._createElement("canvas",this.id),this.bound.appendChild(this.space),document.body.appendChild(this.bound),n=!1),n&&(r=this.bound.getBoundingClientRect(),this.resize(r.width,r.height)),this._mdown=!1,this._mdrag=!1,setTimeout(this._ready.bind(this,i),50),this.bgcolor="#F3F7FA",this.ctx=this.space.getContext("2d")}return D(e,t),e.prototype._createElement=function(t,e){var i;return null==t&&(t="div"),i=document.createElement(t),i.setAttribute("id",e),i},e.prototype._ready=function(t){if(!this.bound)throw"Cannot initiate #"+this.id+" element";return this.boundRect=this.bound.getBoundingClientRect(),this.resize(this.boundRect.width,this.boundRect.height),this.autoResize(this._autoResize),this.bgcolor&&this.clear(this.bgcolor),this.space.dispatchEvent(new Event("ready")),t&&"function"==typeof t?t(this.boundRect,this.space):void 0},e.prototype.display=function(){return console.warn("space.display(...) function is deprecated as of version 0.2.0. You can now set the canvas element in the constructor. Please see the release note for details."),this},e.prototype.setup=function(t){var e,i;return void 0!==t.bgcolor&&(this.bgcolor=t.bgcolor),this._autoResize=t.resize!==!1?!0:!1,this.pixelScale=1,t.retina!==!1&&(e=window.devicePixelRatio||1,i=this.ctx.webkitBackingStorePixelRatio||this.ctx.mozBackingStorePixelRatio||this.ctx.msBackingStorePixelRatio||this.ctx.oBackingStorePixelRatio||this.ctx.backingStorePixelRatio||1,this.pixelScale=e/i),this},e.prototype._resizeHandler=function(t){return this.boundRect=this.bound.getBoundingClientRect(),this.resize(this.boundRect.width,this.boundRect.height,t)},e.prototype.autoResize=function(t){return null==t&&(t=!0),t?window.addEventListener("resize",this._resizeHandler):window.removeEventListener("resize",this._resizeHandler),this},e.prototype.resize=function(t,e,i){var n,s,r;t=Math.floor(t),e=Math.floor(e),this.size.set(t,e),this.center=new w(t/2,e/2),this.boundRect.width=t,this.boundRect.height=e,this.space.width=t*this.pixelScale,this.space.height=e*this.pixelScale,this.space.style.width=t+"px",this.space.style.height=e+"px",1!==this.pixelScale&&this.ctx.scale(this.pixelScale,this.pixelScale),r=this.items;for(n in r)s=r[n],null!=s.onSpaceResize&&s.onSpaceResize(t,e,i);return this.render(this.ctx),this},e.prototype.clear=function(t){var e;return t&&(this.bgcolor=t),e=this.ctx.fillStyle,this.bgcolor&&"transparent"!==this.bgcolor?(this.ctx.fillStyle=this.bgcolor,this.ctx.fillRect(0,0,this.size.x,this.size.y)):this.ctx.clearRect(0,0,this.size.x,this.size.y),this.ctx.fillStyle=e,this},e.prototype.animate=function(t){var e,i,n;this.ctx.save(),this._refresh&&this.clear(),i=this.items;for(e in i)n=i[e],n.animate(t,this._timeDiff,this.ctx);return this._timeEnd>=0&&t>this._timeEnd&&cancelAnimationFrame(this._animID),this.ctx.restore(),this},e}(v),this.CanvasSpace=t,r=function(t){function e(t,i,n){var s,r;null==n&&(n="div"),this._resizeHandler=M(this._resizeHandler,this),t||(t="pt"),r=t instanceof Element,e.__super__.constructor.call(this,r?"pt_custom_space":t),this.space=null,this.bound=null,this.boundRect={top:0,left:0,width:0,height:0},this.css={},s=null,r?s=t:(this.id="#"===this.id[0]?this.id.substr(1):this.id,s=document.querySelector("#"+this.id)),s?(this.space=s,this.bound=this.space.parentElement):(this.space=this._createElement(n,this.id),document.body.appendChild(this.space),this.bound=this.space.parentElement),this._mdown=!1,this._mdrag=!1,setTimeout(this._ready.bind(this,i),50),this.bgcolor=!1,this.ctx={}}return D(e,t),e.prototype._createElement=function(t,e){var i;return null==t&&(t="div"),i=document.createElement(t),i.setAttribute("id",e),i},e.prototype._ready=function(t){if(!this.bound)throw"Cannot initiate #"+this.id+" element";return this.boundRect=this.bound.getBoundingClientRect(),this.resize(this.boundRect.width,this.boundRect.height),this.autoResize(this._autoResize),this.bgcolor&&this.setCSS("backgroundColor",this.bgcolor),this.updateCSS(),this.space.dispatchEvent(new Event("ready")),t?t(this.boundRect,this.space):void 0},e.prototype.setCSS=function(t,e,i){return null==i&&(i=!1),this.css[t]=i?e+"px":e,this},e.prototype.updateCSS=function(){var t,e,i,n;e=this.css,i=[];for(t in e)n=e[t],i.push(this.space.style[t]=n);return i},e.prototype.display=function(){return console.warn("space.display(...) function is deprecated as of version 0.2.0. You can now set the DOM element in the constructor. Please see the release note for details."),this},e.prototype.setup=function(t){return void 0!==t.bgcolor&&(this.bgcolor=t.bgcolor),this._autoResize=t.resize!==!1?!0:!1,this},e.prototype._resizeHandler=function(t){return this.boundRect=this.bound.getBoundingClientRect(),this.resize(this.boundRect.width,this.boundRect.height,t)},e.prototype.resize=function(t,e,i){var n,s,r;this.size.set(t,e),this.center=new w(t/2,e/2),r=this.items;for(n in r)s=r[n],null!=s.onSpaceResize&&s.onSpaceResize(t,e,i);return this},e.prototype.autoResize=function(t){return null==t&&(t=!0),t?(this.css.width="100%",this.css.height="100%",window.addEventListener("resize",this._resizeHandler)):(delete this.css.width,delete this.css.height,window.removeEventListener("resize",this._resizeHandler)),this},e.prototype.clear=function(t){return this.setBackground(t),this.space.innerHML="",this},e.prototype.setBackground=function(t){return t?(this.bgcolor=t,this.setCSS("backgroundColor",this.bgcolor),this.space.style.backgroundColor=this.bgcolor):void 0},e.prototype.animate=function(t){var e,i,n;i=this.items;for(e in i)n=i[e],n.animate(t,this._timeDiff,this.ctx);return this._timeEnd>=0&&t>this._timeEnd&&cancelAnimationFrame(this._animID),this},e.attr=function(t,e){var i,n,s;n=[];for(i in e)s=e[i],n.push(t.setAttribute(i,s));return n},e.css=function(t){var e,i,n;i="";for(e in t)n=t[e],n&&(i+=e+": "+n+"; ");return i},e}(v),this.DOMSpace=r,g=function(){function t(t){this.cc=t.ctx||{},this.cc.group=this.cc.group||null,this.cc.groupID="ptx",this.cc.groupCount=0,this.cc.currentID="ptx0",this.cc.style={fill:"#999",stroke:"#666","stroke-width":1,"stroke-linejoin":!1,"stroke-linecap":!1},this.cc.font="11px sans-serif",this.cc.fontSize=11,this.cc.fontFace="sans-serif"}return t._domId=0,t.prototype.fill=function(t){return this.cc.style.fill=t?t:!1,this},t.prototype.stroke=function(t,e,i,n){return this.cc.style.stroke=t?t:!1,e&&(this.cc.style["stroke-width"]=e),i&&(this.cc.style["stroke-linejoin"]=i),n&&(this.cc.style["stroke-linecap"]=n),this},t.prototype.scope=function(t,e){return null==e&&(e=!1),e&&(this.cc.group=e),this.cc.groupID=t,this.cc.groupCount=0,this.nextID(),this.cc},t.prototype.enterScope=function(e){if(!e||null===e.animateID)throw"getScope()'s item must be added to a Space, and has an animateID property. Otherwise, use scope() instead.";return this.scope(t._scopeID(e))},t.prototype.getScope=function(t){return this._warn1||(console.warn("form.getScope(...) function is deprecated as of version 0.2.0. It is renamed as `enterScope()`."),this._warn1=!0),this.enterScope(t)},t.prototype.nextID=function(){return this.cc.groupCount++,this.cc.currentID=this.cc.groupID+"-"+this.cc.groupCount,this.cc.currentID},t.id=function(e){return e.currentID||"p-"+t._domId++},t._scopeID=function(t){return"item-"+t.animateID},t.style=function(t,e){var i,n,s;n=[];for(i in e)s=e[i],s?n.push(i+":"+s):"fill"===i?n.push("fill: none"):"stroke"===i&&n.push("stroke: none");return r.attr(t,{style:n.join(";")})},t.point=function(e,i,n,s,o,h){var u;return null==n&&(n=2),null==s&&(s=!0),null==o&&(o=!0),null==h&&(h=!1),(u=x.svgElement(e.group,h?"circle":"rect",t.id(e)))?(h?r.attr(u,{cx:i.x,cy:i.y,r:n}):r.attr(u,{x:i.x-n,y:i.y-n,width:n+n,height:n+n}),t.style(u,e.style),u):void 0},t.prototype.point=function(e,i,n){return null==i&&(i=2),null==n&&(n=!1),this.nextID(),t.point(this.cc,e,i,!0,!0,n),this},t.points=function(e,i,n,s,r,o){var h;return null==n&&(n=2),null==s&&(s=!0),null==r&&(r=!0),null==o&&(o=!1),function(){var u,a,c;for(c=[],u=0,a=i.length;a>u;u++)h=i[u],c.push(t.point(e,h,n,s,r,o));return c}()},t.prototype.points=function(t,e,i){var n,s,r;for(null==e&&(e=2),null==i&&(i=!1),n=0,s=t.length;s>n;n++)r=t[n],this.point(r,e,i);return this},t.line=function(e,i){var n;if(!i.p1)throw i.toString()+" is not a Pair";return n=x.svgElement(e.group,"line",t.id(e)),r.attr(n,{x1:i.x,y1:i.y,x2:i.p1.x,y2:i.p1.y}),t.style(n,e.style),n},t.prototype.line=function(e){return this.nextID(),t.line(this.cc,e),this},t.lines=function(e,i){var n;return function(){var s,r,o;for(o=[],s=0,r=i.length;r>s;s++)n=i[s],o.push(t.line(e,n));return o}()},t.prototype.lines=function(t){var e,i,n;for(e=0,i=t.length;i>e;e++)n=t[e],this.line(n);return this},t.rect=function(e,i,n,s){var o,h;if(null==n&&(n=!0),null==s&&(s=!0),!i.p1)throw""+(i.toString()===!a(p));return o=x.svgElement(e.group,"rect",t.id(e)),h=i.size(),r.attr(o,{x:i.x,y:i.y,width:h.x,height:h.y}),t.style(o,e.style),o},t.prototype.rect=function(e,i){var n;return null==i&&(i=!0),this.nextID(),n=i?e.bounds():e,t.rect(this.cc,n),this},t.circle=function(e,i,n,s){var o;return null==n&&(n=!0),null==s&&(s=!1),(o=x.svgElement(e.group,"circle",t.id(e)))?(r.attr(o,{cx:i.x,cy:i.y,r:i.radius}),t.style(o,e.style),o):void 0},t.prototype.circle=function(e){return this.nextID(),t.circle(this.cc,e),this},t.polygon=function(e,i,n,s,o){var h,u,a;return null==n&&(n=!0),null==s&&(s=!0),null==o&&(o=!0),h=x.svgElement(e.group,n?"polygon":"polyline",t.id(e)),!h||i.length<=1?void 0:(a=function(){var t,e,n;for(n=[],u=t=0,e=i.length;e>t;u=t+=1)n.push(i[u].x+","+i[u].y);return n}(),r.attr(h,{points:a.join(" ")}),t.style(h,e.style),h)},t.prototype.polygon=function(e,i){return this.nextID(),t.polygon(this.cc,e,i),this},t.triangle=function(e,i,n,s){return null==n&&(n=!0),null==s&&(s=!1),t.polygon(e,i.toArray())},t.prototype.triangle=function(e){return this.nextID(),t.triangle(this.cc,e),this},t.curve=function(e,i,n){return null==n&&(n=!1),t.polygon(e,i,n)},t.prototype.curve=function(e,i){return null==i&&(i=!1),this.nextID(),t.curve(this.cc,e,i),this},t.text=function(e,i,n,s,o,h){var u;return null==s&&(s=0),null==o&&(o=0),null==h&&(h=0),(u=x.svgElement(e.group,"text",t.id(e)))?(r.attr(u,{"pointer-events":"none",x:i.x,y:i.y,dx:0,dy:0}),u.textContent=n,t.style(u,{fill:e.style.fill,stroke:e.style.stroke,"font-family":e.fontFace||!1,"font-size":e.fontSize||!1}),u):void 0},t.prototype.text=function(e,i,n,s,r){return null==n&&(n=1e3),this.nextID(),t.text(this.cc,e,i,n,s,r),this},t.prototype.font=function(t,e){return null==e&&(e=!1),this.cc.fontFace=e,this.cc.fontSize=t,this.cc.font=t+"px "+e,this},t.prototype.draw=function(t){return this.sketch(t)},t.prototype.sketch=function(i){return i.floor(),i instanceof e?t.circle(this.cc,i,this.filled,this.stroked):i instanceof m?t.rect(this.cc,i,this.filled,this.stroked):i instanceof _?t.triangle(this.cc,i,this.filled,this.stroked):i instanceof u||i instanceof p?t.line(this.cc,i):i instanceof d?t.polygon(this.cc,i.points):(i instanceof w||i instanceof f)&&t.point(this.cc,i),this},t}(),this.SVGForm=g,x=function(t){function e(t,i){var n,s;e.__super__.constructor.call(this,t,i,"svg"),"svg"!==this.space.nodeName.toLowerCase()&&(s=this._createElement("svg",this.id+"_svg"),this.space.appendChild(s),this.bound=this.space,this.space=s,n=this.bound.getBoundingClientRect(),this.resize(n.width,n.height))}return D(e,t),e.prototype._createElement=function(t,e){var i;return null==t&&(t="svg"),i=document.createElementNS("http://www.w3.org/2000/svg",t),e&&i.setAttribute("id",e),i},e.svgElement=function(t,e,i){var n;if(!(t&&t.appendChild||(t=this.space)))throw"parent parameter needs to be a DOM node";return n=document.querySelector("#"+i),n||(n=document.createElementNS("http://www.w3.org/2000/svg",e),n.setAttribute("id",i),n.setAttribute("class",i.substring(0,i.indexOf("-"))),t.appendChild(n)),n},e.prototype.remove=function(t){var e,i,n,s;for(s=this.space.querySelectorAll("."+g._scopeID(t)),e=0,i=s.length;i>e;e++)n=s[e],n.parentNode.removeChild(n);return delete this.items[t.animateID],this},e.prototype.removeAll=function(){for(;this.space.firstChild;)return this.space.removeChild(this.space.firstChild),this},e}(r),this.SVGSpace=x,o=function(){function t(t){this.space=t,this.cc=t.ctx,this.cc.fillStyle="#999",this.cc.strokeStyle="#666",this.cc.lineWidth=1,this.cc.font="11px sans-serif",this.filled=!0,this.stroked=!0,this.fontSize=11,this.fontFace="sans-serif"}return t.context=function(t){var e,i;if(i=document.getElementById(t),e=i&&i.getContext?i.getContext("2d"):!1,!e)throw"Cannot initiate canvas 2d context";return e},t.line=function(t,e){if(!e.p1)throw e.toString()+" is not a Pair";return t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(e.p1.x,e.p1.y),t.stroke()},t.lines=function(e,i){var n,s,r,o;for(o=[],n=0,s=i.length;s>n;n++)r=i[n],o.push(t.line(e,r));return o},t.rect=function(t,e,i,n){if(null==i&&(i=!0),null==n&&(n=!1),!e.p1)throw""+(e.toString()===!a(p));return t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(e.x,e.p1.y),t.lineTo(e.p1.x,e.p1.y),t.lineTo(e.p1.x,e.y),t.closePath(),n&&t.stroke(),i?t.fill():void 0},t.circle=function(t,e,i,s){null==i&&(i=!0),null==s&&(s=!1),t.beginPath(),t.arc(e.x,e.y,e.radius,0,n.two_pi,!1),i&&t.fill(),s&&t.stroke()},t.arc=function(t,e,i,n,s){return t.beginPath(),t.arc(e.x,e.y,i,n,s),t.stroke()},t.triangle=function(t,e,i,n){null==i&&(i=!0),null==n&&(n=!1),t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(e.p1.x,e.p1.y),t.lineTo(e.p2.x,e.p2.y),t.closePath(),i&&t.fill(),n&&t.stroke()},t.point=function(t,e,i,s,r,o){var h,u,a,c;return null==i&&(i=2),null==s&&(s=!0),null==r&&(r=!1),null==o&&(o=!1),o?(t.beginPath(),t.arc(e.x,e.y,i,0,n.two_pi,!1)):(h=e.x-i,a=e.y-i,u=e.x+i,c=e.y+i,t.beginPath(),t.moveTo(h,a),t.lineTo(h,c),t.lineTo(u,c),t.lineTo(u,a),t.closePath()),s&&t.fill(),r&&t.stroke(),e},t.points=function(e,i,n,s,r,o){var h,u,a,c;for(null==n&&(n=2),null==s&&(s=!0),null==r&&(r=!1),null==o&&(o=!1),c=[],h=0,u=i.length;u>h;h++)a=i[h],c.push(t.point(e,a,n,s,r,o));return c},t.polygon=function(t,e,i,n,s){var r,o,h;if(null==i&&(i=!0),null==n&&(n=!0),null==s&&(s=!0),!(e.length<=1)){for(t.beginPath(),t.moveTo(e[0].x,e[0].y),r=o=1,h=e.length;h>o;r=o+=1)t.lineTo(e[r].x,e[r].y);i&&t.closePath(),n&&t.fill(),s&&t.stroke()}},t.curve=function(e,i){return t.polygon(e,i,!1,!1,!0)},t.text=function(t,e,i,n){return t.fillText(i,e.x,e.y,n)},t.prototype.fill=function(t){return this.cc.fillStyle=t?t:"transparent",this.filled=!!t,this},t.prototype.stroke=function(t,e,i,n){return this.cc.strokeStyle=t?t:"transparent",this.stroked=!!t,e&&(this.cc.lineWidth=e),i&&(this.cc.lineJoin=i),n&&(this.cc.lineCap=n),this},t.prototype.font=function(t,e){return null==e&&(e=this.fontFace),this.fontSize=t,this.cc.font=t+"px "+e,this},t.prototype.draw=function(t){return this.sketch(t)},t.prototype.sketch=function(i){return i.floor(),i instanceof e?t.circle(this.cc,i,this.filled,this.stroked):i instanceof m?t.rect(this.cc,i,this.filled,this.stroked):i instanceof _?t.triangle(this.cc,i,this.filled,this.stroked):i instanceof u||i instanceof p?t.line(this.cc,i):i instanceof d?t.polygon(this.cc,i.points):(i instanceof w||i instanceof f)&&t.point(this.cc,i),this},t.prototype.point=function(e,i,n){return null==i&&(i=2),null==n&&(n=!1),t.point(this.cc,e,i,this.filled,this.stroked,n),this},t.prototype.points=function(e,i,n){return null==i&&(i=2),null==n&&(n=!1),t.points(this.cc,e,i,this.filled,this.stroked,n),this},t.prototype.line=function(e){return t.line(this.cc,e),this},t.prototype.lines=function(e){return t.lines(this.cc,e),this},t.prototype.rect=function(e){return t.rect(this.cc,e,this.filled,this.stroked),this},t.prototype.circle=function(e){return t.circle(this.cc,e,this.filled,this.stroked),this},t.prototype.arc=function(e,i,n){return t.arc(this.cc,e,e.radius,i,n),this},t.prototype.triangle=function(e){return t.triangle(this.cc,e,this.filled,this.stroked),this},t.prototype.polygon=function(e,i){return t.polygon(this.cc,e,i,this.filled,this.stroked),this},t.prototype.curve=function(e){return t.curve(this.cc,e),this},t.prototype.text=function(t,e,i,n,s){var r;return null==i&&(i=1e3),r=new w(t),n&&r.add(n,0),s&&r.add(0,s),this.cc.fillText(e,r.x,r.y,i),this},t.prototype.scope=function(){return this.cc},t.prototype.enterScope=function(){return this.cc},t}(),this.Form=o,f=function(){function t(e){this.copy(t.get(arguments))}return t.get=function(t){return t.length>0?"object"==typeof t[0]?t[0]instanceof Array||t[0].length>0?{x:t[0][0]||0,y:t[0][1]||0,z:t[0][2]||0}:{x:t[0].x||0,y:t[0].y||0,z:t[0].z||0}:{x:t[0]||0,y:t[1]||0,z:t[2]||0}:{x:0,y:0,z:0}},t.prototype.quadrant=function(t,e){return null==e&&(e=n.epsilon),t.near(this)?n.identical:Math.abs(t.x-this.x)<e?t.y<this.y?n.top:n.bottom:Math.abs(t.y-this.y)<e?t.x<this.x?n.left:n.right:t.y<this.y&&t.x>this.x?n.top_right:t.y<this.y&&t.x<this.x?n.top_left:t.y>this.y&&t.x<this.x?n.bottom_left:n.bottom_right},t.prototype.set=function(e){var i;return i=t.get(arguments),this.x=i.x,this.y=i.y,this.z=i.z,this},t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},t.prototype.clone=function(){return new t(this)},t.prototype.toString=function(){return"Point "+this.x+", "+this.y+", "+this.z},t.prototype.toArray=function(){return[this]},t.prototype.get2D=function(t,e){return null==e&&(e=!1),t===n.xy?new this.__proto__.constructor(this):t===n.xz?new this.__proto__.constructor(this.x,this.z,this.y):t===n.yz?e?new this.__proto__.constructor(this.z,this.x,this.y):new this.__proto__.constructor(this.y,this.z,this.x):new this.__proto__.constructor(this)},t.prototype.min=function(e){var i;return i=t.get(arguments),this.x=Math.min(this.x,i.x),this.y=Math.min(this.y,i.y),this.z=Math.min(this.z,i.z),this},t.prototype.$min=function(e){var i;return i=t.get(arguments),new this.__proto__.constructor(Math.min(this.x,i.x),Math.min(this.y,i.y),Math.min(this.z,i.z))},t.prototype.max=function(e){var i;return i=t.get(arguments),this.x=Math.max(this.x,i.x),this.y=Math.max(this.y,i.y),this.z=Math.max(this.z,i.z),this},t.prototype.$max=function(e){var i;return i=t.get(arguments),new this.__proto__.constructor(Math.max(this.x,i.x),Math.max(this.y,i.y),Math.max(this.z,i.z))},t.prototype.equal=function(e){var i;return i=t.get(arguments),i.x===this.x&&i.y===this.y&&i.z===this.z},t.prototype.near=function(e,i){var s;return null==i&&(i=n.epsilon),s=t.get(arguments),Math.abs(s.x-this.x)<i&&Math.abs(s.y-this.y)<i&&Math.abs(s.z-this.z)<i},t.prototype.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},t.prototype.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},t}(),this.Point=f,w=function(t){function e(){e.__super__.constructor.apply(this,arguments)}return D(e,t),e.prototype._getArgs=function(t){return"number"==typeof t[0]&&t.length>1?t:t[0]},e.prototype.add=function(t){var e;return"number"==typeof arguments[0]&&1===arguments.length?(this.x+=arguments[0],this.y+=arguments[0],this.z+=arguments[0]):(e=f.get(arguments),this.x+=e.x,this.y+=e.y,this.z+=e.z),this},e.prototype.$add=function(t){var i;return i=this._getArgs(arguments),new e(this).add(i)},e.prototype.subtract=function(t){var e;return"number"==typeof arguments[0]&&1===arguments.length?(this.x-=arguments[0],this.y-=arguments[0],this.z-=arguments[0]):(e=f.get(arguments),this.x-=e.x,this.y-=e.y,this.z-=e.z),this},e.prototype.$subtract=function(t){var i;return i=this._getArgs(arguments),new e(this).subtract(i)},e.prototype.multiply=function(t){var e;return 1===arguments.length&&("number"==typeof arguments[0]||"object"==typeof arguments[0]&&1===arguments[0].length)?(this.x*=arguments[0],this.y*=arguments[0],this.z*=arguments[0]):(e=f.get(arguments),this.x*=e.x,this.y*=e.y,this.z*=e.z),this},e.prototype.$multiply=function(t){var i;return i=this._getArgs(arguments),new e(this).multiply(i)},e.prototype.divide=function(t){var e;return 1===arguments.length&&("number"==typeof arguments[0]||"object"==typeof arguments[0]&&1===arguments[0].length)?(this.x/=arguments[0],this.y/=arguments[0],this.z/=arguments[0]):(e=f.get(arguments),this.x/=e.x,this.y/=e.y,this.z/=e.z),this},e.prototype.$divide=function(t){var i;return i=this._getArgs(arguments),new e(this).divide(i)},e.prototype.op=function(){var t,e,i,n,s,r;for(n=arguments[0],t=2<=arguments.length?L.call(arguments,1):[],r=this.toArray(),e=0,i=r.length;i>e;e++)s=r[e],s[n].apply(s,t);return this},e.prototype.$op=function(){var t,e,i,n,s,r,o;for(s=arguments[0],t=2<=arguments.length?L.call(arguments,1):[],e=this.clone(),o=e.toArray(),i=0,n=o.length;n>i;i++)r=o[i],r[s].apply(r,t);return e},e.prototype.angle=function(t){var e,i;return 0===arguments.length?Math.atan2(this.y,this.x):("string"==typeof arguments[0]?(e=arguments[0],i=arguments.length>1?this.$subtract(arguments[1]).multiply(-1):void 0):(i=this.$subtract(arguments[0]).multiply(-1),e=!1),i&&!e?Math.atan2(i.y,i.x):e===n.xy?i?Math.atan2(i.y,i.x):Math.atan2(this.y,this.x):e===n.yz?i?Math.atan2(i.z,i.y):Math.atan2(this.z,this.y):e===n.xz?i?Math.atan2(i.z,i.x):Math.atan2(this.z,this.x):void 0)},e.prototype.angleBetween=function(t,e){return null==e&&(e=n.xy),b.boundRadian(this.angle(e),!0)-b.boundRadian(t.angle(e),!0)},e.prototype.magnitude=function(t){var e,i,s,r,o,h;return s={x:this.x*this.x,y:this.y*this.y,z:this.z*this.z},h=arguments.length>=1&&!arguments[arguments.length-1],e=h?function(t){return t}:Math.sqrt,0===arguments.length?e(s.x+s.y+s.z):("string"==typeof arguments[0]?(i=arguments[0],o=arguments.length>1&&arguments[1]?this.$subtract(arguments[1]):void 0):(o=this.$subtract(arguments[0]),
i=!1),r=o?{x:o.x*o.x,y:o.y*o.y,z:o.z*o.z}:s,o&&!i?e(r.x+r.y+r.z):i===n.xy?e(r.x+r.y):i===n.yz?e(r.y+r.z):i===n.xz?e(r.x+r.z):void 0)},e.prototype.distance=function(t,e){return null==e&&(e=n.xy),this.magnitude(e,t)},e.prototype.normalize=function(){return this.set(this.$normalize()),this},e.prototype.$normalize=function(){var t;return t=this.magnitude(),0===t?new e:new e(this.x/t,this.y/t,this.z/t)},e.prototype.abs=function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z),this},e.prototype.dot=function(t,e){return null==e&&(e=n.xyz),e===n.xyz?this.x*t.x+this.y*t.y+this.z*t.z:e===n.xy?this.x*t.x+this.y*t.y:e===n.yz?this.y*t.y+this.z*t.z:e===n.xz?this.x*t.x+this.z*t.z:this.x*t.x+this.y*t.y+this.z*t.z},e.prototype.projection=function(t,i){var s,r,o,h;return null==i&&(i=n.xyz),h=t.magnitude(),s=this.$normalize(),r=new e(t.x/h,t.y/h,t.z/h),o=s.dot(r,i),s.$multiply(h*o)},e.prototype.cross=function(t){return new e(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},e.prototype.bisect=function(t,e){return null==e&&(e=!1),e?this.$add(t).divide(2):this.$normalize().add(t.$normalize()).divide(2)},e.prototype.perpendicular=function(t){switch(null==t&&(t=n.xy),t){case n.xy:return[new e(-this.y,this.x,this.z),new e(this.y,-this.x,this.z)];case n.yz:return[new e(this.x,-this.z,this.y),new e(this.x,this.z,-this.y)];case n.xz:return[new e(-this.z,this.y,this.x),new e(this.z,-this.y,this.x)];default:return[new e(-this.y,this.x,this.z),new e(this.y,-this.x,this.z)]}},e.prototype.isPerpendicular=function(t,e){return null==e&&(e=n.xyz),0===this.dot(t,e)},e.prototype.surfaceNormal=function(t){return this.cross(t).normalize(!0)},e.prototype.moveTo=function(t){var e,i,n,s,r,o;for(o=f.get(arguments),e=this.$subtract(o),r=this.toArray(),i=0,n=r.length;n>i;i++)s=r[i],s.subtract(e);return this},e.prototype.moveBy=function(t){var e,i,n,s,r;for(e=f.get(arguments),r=this.toArray(),i=0,n=r.length;n>i;i++)s=r[i],s.add(e);return this},e.prototype.rotate2D=function(t,e,i){var s,r,o,h,u;for(null==i&&(i=n.xy),e||(e=new f(0,0,0)),o=c.rotateAnchor2D(t,e,i),u=this.toArray(),s=0,r=u.length;r>s;s++)h=u[s],c.transform2D(h,o,i);return this},e.prototype.reflect2D=function(t,e){var i,s,r,o,h;for(null==e&&(e=n.xy),r=c.reflectAnchor2D(t,e),h=this.toArray(),i=0,s=h.length;s>i;i++)o=h[i],c.transform2D(o,r,e);return this},e.prototype.scale2D=function(t,e,i,s){var r,o,h,u,a;for(null==s&&(s=n.xy),i||(i=new f(0,0,0)),h=c.scaleAnchor2D(t,e,i,s),a=this.toArray(),r=0,o=a.length;o>r;r++)u=a[r],c.transform2D(u,h,s);return this},e.prototype.shear2D=function(t,e,i,s){var r,o,h,u,a;for(null==s&&(s=n.xy),i||(i=new f(0,0,0)),h=c.shearAnchor2D(t,e,i,s),a=this.toArray(),r=0,o=a.length;o>r;r++)u=a[r],c.transform2D(u,h,s);return this},e.prototype.clone=function(){return new e(this)},e.prototype.toString=function(){return"Vector "+this.x+", "+this.y+", "+this.z},e}(f),this.Vector=w,i=function(t){function e(t){var i;e.__super__.constructor.apply(this,arguments),i=Array.isArray(arguments[0])&&void 0!==arguments[0][3]?arguments[0]:arguments,this.alpha=i.length>=4?Math.min(1,Math.max(i[3],0)):1,this.mode="rgb",arguments.length>=5&&(this.mode=arguments[4]),"string"==typeof arguments[1]&&(this.mode=arguments[1])}return D(e,t),e.XYZ={D65:{x:95.047,y:100,z:108.883}},e.parseHex=function(t,i){var n,s;return null==i&&(i=!1),0===t.indexOf("#")&&(t=t.substr(1)),3===t.length&&(t=""+t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),8===t.length&&(this.alpha=1&t.substr(6),t=t.substring(0,6)),n=parseInt(t,16),s=[n>>16,n>>8&255,255&n],i?new e(s[0],s[1],s[2]):s},e.prototype.setMode=function(t){if(t=t.toLowerCase(),t!==this.mode){switch(this.mode){case"hsl":this.copy(f.get(e.HSLtoRGB(this.x,this.y,this.z)));break;case"hsb":this.copy(f.get(e.HSBtoRGB(this.x,this.y,this.z)));break;case"lab":this.copy(f.get(e.LABtoRGB(this.x,this.y,this.z)));break;case"lch":this.copy(f.get(e.LCHtoRGB(this.x,this.y,this.z)));break;case"xyz":this.copy(f.get(e.XYZtoRGB(this.x,this.y,this.z)))}switch(t){case"hsl":this.copy(f.get(e.RGBtoHSL(this.x,this.y,this.z)));break;case"hsb":this.copy(f.get(e.RGBtoHSB(this.x,this.y,this.z)));break;case"lab":this.copy(f.get(e.RGBtoLAB(this.x,this.y,this.z)));break;case"lch":this.copy(f.get(e.RGBtoLCH(this.x,this.y,this.z)));break;case"xyz":this.copy(f.get(e.RGBtoXYZ(this.x,this.y,this.z)))}}return this.mode=t,this},e.prototype.hex=function(){var t,e,i,n;return"rgb"===this.mode&&this.floor(),e=this.values("rgb"!==this.mode),t=function(t){return t=t.toString(16),t.length<2?"0"+t:t},i=function(){var i,s,r;for(r=[],i=0,s=e.length;s>i;i++)n=e[i],r.push(t(n));return r}(),"#"+i[0]+i[1]+i[2]},e.prototype.rgb=function(){var t;return"rgb"===this.mode&&this.floor(),t=this.values("rgb"!==this.mode),"rgb("+t[0]+", "+t[1]+", "+t[2]+")"},e.prototype.rgba=function(){var t;return"rgb"===this.mode&&this.floor(),t=this.values("rgb"!==this.mode),"rgba("+t[0]+", "+t[1]+", "+t[2]+", "+this.alpha+")"},e.prototype.values=function(t){var i,n;if(null==t&&(t=!1),i=[this.x,this.y,this.z],t&&"rgb"!==this.mode)switch(this.mode){case"hsl":i=e.HSLtoRGB(this.x,this.y,this.z);break;case"hsb":i=e.HSBtoRGB(this.x,this.y,this.z);break;case"lab":i=e.LABtoRGB(this.x,this.y,this.z);break;case"lch":i=e.LCHtoRGB(this.x,this.y,this.z);break;case"xyz":i=e.XYZtoRGB(this.x,this.y,this.z)}return function(){var t,e,s;for(s=[],t=0,e=i.length;e>t;t++)n=i[t],s.push(Math.floor(n));return s}()},e.prototype.clone=function(){var t;return t=new e(this.x,this.y,this.z,this.alpha),t.mode=this.mode,t},e.prototype.toString=function(){return"Color ("+this.mode+" mode): "+this.x+", "+this.y+", "+this.z+" "+this.alpha},e.RGBtoHSL=function(t,e,i,n,s){var r,o,h,u,a,c;if(n||(t/=255,e/=255,i/=255),u=Math.max(t,e,i),a=Math.min(t,e,i),o=(u+a)/2,c=o,h=o,u===a)o=0,c=0;else switch(r=u-a,c=h>.5?r/(2-u-a):r/(u+a),u){case t:o=(e-i)/r+(i>e?6:0);break;case e:o=(i-t)/r+2;break;case i:o=(t-e)/r+4;break;default:o=0}return s?[o/60,c,h]:[60*o,c,h]},e.HSLtoRGB=function(t,e,i,n,s){var r,o,h,u,a,c;return 0===e?s?[1,1,1]:[255,255,255]:(n||(t/=360),a=.5>=i?i*(1+e):i+e-i*e,u=2*i-a,h=function(t,e,i){return 0>i?i+=1:i>1&&(i-=1),1>6*i?t+(e-t)*i*6:1>2*i?e:2>3*i?t+(e-t)*(2/3-i)*6:t},c=h(u,a,t+1/3),o=h(u,a,t),r=h(u,a,t-1/3),s?[c,o,r]:[255*c,255*o,255*r])},e.RGBtoHSB=function(t,e,i,n,s){var r,o,h,u,a,c;if(n||(t/=255,e/=255,i/=255),h=Math.max(t,e,i),u=Math.min(t,e,i),r=h-u,a=0===h?0:r/h,c=h,h===u)o=0;else switch(h){case t:o=(e-i)/r+(i>e?6:0);break;case e:o=(i-t)/r+2;break;case i:o=(t-e)/r+4;break;default:o=0}return s?[o/60,a,c]:[60*o,a,c]},e.HSBtoRGB=function(t,e,i,n,s){var r,o,h,u,a,c;switch(n||(t/=360),o=Math.floor(6*t),r=6*t-o,h=i*(1-e),u=i*(1-r*e),c=i*(1-(1-r)*e),o%6){case 0:a=[i,c,h];break;case 1:a=[u,i,h];break;case 2:a=[h,i,c];break;case 3:a=[h,u,i];break;case 4:a=[c,h,i];break;case 5:a=[i,h,u];break;default:a=[0,0,0]}return s?a:[255*a[0],255*a[1],255*a[2]]},e.RGBtoLAB=function(t,i,n,s,r){var o;return s&&(t*=255,i*=255,n*=255),o=e.RGBtoXYZ(t,i,n),e.XYZtoLAB(o[0],o[1],o[2])},e.LABtoRGB=function(t,i,n,s,r){var o,h;return s&&(t*=100,i=127*(i-.5),n=127*(n-.5)),h=e.LABtoXYZ(t,i,n),o=e.XYZtoRGB(h[0],h[1],h[2]),r?[o[0]/255,o[1]/255,o[2]/255]:o},e.RGBtoLCH=function(t,i,n,s,r){var o,h;return s&&(t*=255,i*=255,n*=255),o=e.RGBtoLAB(t,i,n),h=e.LABtoLCH(o[0],o[1],o[2]),r?[h[0]/100,h[1]/100,h[2]/360]:h},e.LCHtoRGB=function(t,i,n,s,r){var o,h,u;return s&&(t*=100,i*=100,n*=360),o=e.LCHtoLAB(t,i,n),u=e.LABtoXYZ(o[0],o[1],o[2]),h=e.XYZtoRGB(u[0],u[1],u[2]),r?[h[0]/255,h[1]/255,h[2]/255]:h},e.XYZtoRGB=function(t,e,i,n,s){var r,o,h,u,a;for(n||(t/=100,e/=100,i/=100),a=[3.2404542*t+-1.5371385*e+i*-.4985314,t*-.969266+1.8760108*e+.041556*i,.0556434*t+e*-.2040259+1.0572252*i],o=h=0,u=a.length;u>h;o=++h)r=a[o],a[o]=0>r?0:Math.min(1,r>.0031308?1.055*Math.pow(r,1/2.4)-.055:12.92*r);return s?a:[Math.round(255*a[0]),Math.round(255*a[1]),Math.round(255*a[2])]},e.RGBtoXYZ=function(t,e,i,n,s){return n||(t/=255,e/=255,i/=255),t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92,e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92,s||(t=100*t,e=100*e,i=100*i),[.4124564*t+.3575761*e+.1804375*i,.2126729*t+.7151522*e+.072175*i,.0193339*t+.119192*e+.9503041*i]},e.XYZtoLAB=function(t,i,n){var s,r;return t/=e.XYZ.D65.x,i/=e.XYZ.D65.y,n/=e.XYZ.D65.z,s=function(t){return t>.008856?Math.pow(t,1/3):7.787*t+16/116},r=s(i),[116*r-16,500*(s(t)-r),200*(r-s(n))]},e.LABtoXYZ=function(t,i,n){var s,r,o,h,u;return h=(t+16)/116,r=i/500+h,u=h-n/200,s=function(t){var e;return e=Math.pow(t,3),e>.008856?e:(t-16/116)/7.787},o=[Math.min(e.XYZ.D65.x,e.XYZ.D65.x*s(r)),Math.min(e.XYZ.D65.y,e.XYZ.D65.y*s(h)),Math.min(e.XYZ.D65.y,e.XYZ.D65.z*s(u))]},e.XYZtoLUV=function(t,i,n){var s,r,o,h,u;return h=4*t/(t+15*i+3*n),u=9*i/(t+15*i+3*n),i/=100,i=i>.008856?Math.pow(i,1/3):7.787*i+16/116,r=4*e.XYZ.D65.x/(e.XYZ.D65.x+15*e.XYZ.D65.y+3*e.XYZ.D65.z),o=9*e.XYZ.D65.y/(e.XYZ.D65.x+15*e.XYZ.D65.y+3*e.XYZ.D65.z),s=116*i-16,[s,13*s*(h-r),13*s*(u-o)]},e.LUVtoXYZ=function(t,i,n){var s,r,o,h,u;return u=(t+16)/116,s=u*u*u,u=s>.008856?s:(u-16/116)/7.787,r=4*e.XYZ.D65.x/(e.XYZ.D65.x+15*e.XYZ.D65.y+3*e.XYZ.D65.z),o=9*e.XYZ.D65.y/(e.XYZ.D65.x+15*e.XYZ.D65.y+3*e.XYZ.D65.z),i=i/(13*t)+r,n=n/(13*t)+o,u=100*u,h=-9*u*i/((i-4)*n-i*n),[h,u,(9*u-15*n*u-n*h)/(3*n)]},e.LABtoLCH=function(t,e,i){var n;return n=Math.atan2(i,e),n=n>0?180*n/Math.PI:360-180*Math.abs(n)/Math.PI,[t,Math.sqrt(e*e+i*i),n]},e.LCHtoLAB=function(t,e,i){var n;return n=Math.PI*i/180,[t,Math.cos(n)*e,Math.sin(n)*e]},e.LUVtoLCH=function(t,e,i){return LABtoLCH(t,e,i)},e.LCHtoLUV=function(t,e,i){return LCHtoLAB(t,e,i)},e}(w),this.Color=i,e=function(t){function e(){e.__super__.constructor.apply(this,arguments),this.radius=null!=arguments[3]?arguments[3]:0}return D(e,t),e.prototype.setRadius=function(t){return this.radius=t,this},e.prototype.intersectPoint=function(t){var e,i;return i=new w(f.get(arguments)),e=i.$subtract(this),e.x*e.x+e.y*e.y<this.radius*this.radius},e.prototype.intersectPath=function(t,e){var i,s,r,o,h,u,a,c,l,y,d,m,g;return null==e&&(e=!0),!t instanceof p?!1:(o=t.direction(),a=this.$subtract(t),i=o.dot(o,n.xy),s=a.dot(o,n.xy),r=a.dot(a,n.xy)-this.radius*this.radius,c=s/i,d=r/i,h=c*c-d,0>h?e?[]:!1:e?(u=Math.sqrt(h),m=-c+u,g=-c-u,l=new f(t.x-o.x*m,t.y-o.y*m),y=new f(t.x-o.x*g,t.y-o.y*g),0===h?[l]:[l,y]):!0)},e.prototype.intersectLine=function(t,e){var i,n,s,r,o,h;if(null==e&&(e=!0),h=this.intersectPath(t),h&&h.length>0){for(o=[],i=t.bounds(),n=0,s=h.length;s>n;n++)if(r=h[n],m.contain(r,i,i.p1)){if(!e)return!0;o.push(r)}return e?o:o.length>0}return e?[]:!1},e.prototype.intersectLines=function(t,e){return null==e&&(e=!0),u.intersectLines(this,t,e)},e.prototype.intersectCircle=function(t,e){var i,n,s,r,o,h,u,a;return null==e&&(e=!0),h=t.$subtract(this),o=h.magnitude(!1),r=Math.sqrt(o),n=this.radius*this.radius,s=t.radius*t.radius,r>this.radius+t.radius?e?[]:!1:r<Math.abs(this.radius-t.radius)?e?[new w(this),new w(t)]:!0:e?(i=(n-s+o)/(2*r),u=Math.sqrt(n-i*i),a=h.$multiply(i/r).add(this),[new w(a.x+u*h.y/r,a.y-u*h.x/r),new w(a.x-u*h.y/r,a.y+u*h.x/r)]):!0},e.prototype.hasIntersect=function(t,i){var n,s;return null==i&&(i=!1),t instanceof e?this.intersectCircle(t,i):t instanceof m||t instanceof d||t instanceof _?this.intersectLines(t.sides(),i):t instanceof p?(s=this.intersectLine(t),i?s:s.length>0):t instanceof f?(n=t.$subtract(this),n.x*n.x+n.y*n.y<this.radius*this.radius):i?[]:!1},e.prototype.toString=function(){return"Circle of "+this.radius+" radius at center "+this.x+", "+this.y+", "+this.z},e}(w),this.Circle=e,l=function(t){function e(){e.__super__.constructor.apply(this,arguments),this.id=0,this.life={age:0,maxAge:0,active:!0,complete:!1},this.momentum=new w,this.velocity=new w,this.mass=2,this.friction=0,this.frame_ms=20}return D(e,t),e.prototype.play=function(t,e){var i,n,s;for(s=0,n=[];e>0;)i=Math.min(e,this.frame_ms),this.integrate(s/1e3,i/1e3),e-=i,s+=i,n.push(this.life.age++);return n},e.prototype.integrate=function(t,e){return this.integrateRK4(t,e)},e.prototype.forces=function(t,e){return{force:new w}},e.prototype.impulse=function(t){return this.momentum.add(t),this.velocity=this.momentum.$divide(this.mass)},e.prototype._evaluate=function(t,e,i){var n,s;return null==e&&(e=0),null==i&&(i=!1),s=0!==e&&i?{position:this.$add(i.velocity.$multiply(e)),momentum:this.momentum.$add(i.force.$multiply(e))}:{position:new w(this),momentum:new w(this.momentum)},s.velocity=s.momentum.$divide(this.mass),n=this.forces(s,t+e),{velocity:s.velocity,force:n.force}},e.prototype.integrateRK4=function(t,e){var i,n,s,r,o;return i=function(t,e,i,n){var s;return s=new w((t.x+2*(e.x+i.x)+n.x)/6,(t.y+2*(e.y+i.y)+n.y)/6,(t.z+2*(e.z+i.z)+n.z)/6)},n=this._evaluate(t,0),s=this._evaluate(t,.5*e,n),r=this._evaluate(t,.5*e,s),o=this._evaluate(t,e,r),this.add(i(n.velocity,s.velocity,r.velocity,o.velocity)),this.momentum.add(i(n.force,s.force,r.force,o.force))},e.prototype.integrateEuler=function(t,e){var i;return i=this.forces({position:new w(this),momentum:new w(this.momentum)},t+e),this.add(this.velocity),this.momentum.add(i.force),this.velocity=this.momentum.$divide(this.mass)},e.prototype.collideLine2d=function(t,e){var i,s,r,o,h,a,c,p,l,y,f,d,m,g,x,v,z,_,b,M;if(null==e&&(e=!0),h=new w(this),o=Math.abs(t.getDistanceFromPoint(h)),s=Math.abs(o)<this.radius,e&&(l=this.$add(this.velocity),p=Math.abs(t.getDistanceFromPoint(l)),r=t.intersectLine(new u(h).to(l)),r&&(l=r.$add(this.velocity.$normalize().$multiply(-this.radius/2)),p=Math.abs(t.getDistanceFromPoint(l)),s=!0)),s){if(v=t.getPerpendicularFromPoint(h),M=t.$subtract(t.p1),i=!1,!t.withinBounds(v,n.xy)){if(this.intersectPoint(t)&&(i=!0,c=this.$subtract(t)),this.intersectPoint(t.p1)&&(i=!0,c=this.$subtract(t.p1)),!i)return!1;M=new w(-c.y,c.x)}a=M.dot(this.velocity),m=M.$multiply(a/M.dot(M)),b=m.$subtract(this.velocity),this.velocity=m.$add(b),this.momentum=this.velocity.$multiply(this.mass),e&&!i&&(f=new u(v).to(h),d=t.getPerpendicularFromPoint(l),y=new u(v).to(d),z=y.direction(),_=(this.radius-o)/(p-o),g=z.$multiply(_).$add(y),x=g.$add(f.direction().$normalize().$multiply(this.radius)),this.set(x.$add(this.velocity.$normalize())))}return s},e.prototype.collideWithinBounds=function(t){return this.x-this.radius<t.x||this.x+this.radius>t.p1.x?(this.x-this.radius<t.x?this.x=t.x+this.radius:this.x+this.radius>t.p1.x&&(this.x=t.p1.x-this.radius),this.velocity.x*=-1,this.momentum=this.velocity.$multiply(this.mass),!0):this.y-this.radius<t.y||this.y+this.radius>t.p1.y?(this.y-this.radius<t.y?this.y=t.y+this.radius:this.y+this.radius>t.p1.y&&(this.y=t.p1.y-this.radius),this.velocity.y*=-1,this.momentum=this.velocity.$multiply(this.mass),!0):!1},e.prototype.collideParticle2d=function(t){return this.hasIntersect(t)?e.collideParticle2d(this,t,!0):!1},e.collideParticle2d=function(t,e,i,n){var s,r,o,h,u,a,c,p,l,y,f,d,m,g,x,v,z;return null==i&&(i=!0),null==n&&(n=!0),y=t.$subtract(e).normalize(),m=new w(-y.y,y.x),h=y.dot(t.velocity),u=m.dot(t.velocity),a=y.dot(e.velocity),c=m.dot(e.velocity),s=(h*(t.mass-e.mass)+2*e.mass*a)/(t.mass+e.mass),r=(a*(e.mass-t.mass)+2*t.mass*h)/(t.mass+e.mass),g=y.$multiply(s),x=m.$multiply(u),v=y.$multiply(r),z=m.$multiply(c),f=g.$add(x),d=v.$add(z),n&&(p=t.magnitude(e),p<t.radius+e.radius&&(o=t.$subtract(e).normalize(),l=Math.abs(p-t.radius-e.radius)/1.98,t.add(o.multiply(l)),e.add(o.multiply(-l)))),i&&(t.velocity=f,e.velocity=d,t.momentum=t.velocity.$multiply(t.mass),e.momentum=e.velocity.$multiply(e.mass)),[f,d]},e.force_gravitation=function(t,e,i,n,s){var r,o,h,u;return null==s&&(s=.0067),u=30,r=n.$subtract(t.position),h=r.magnitude()/u,o=0===h?0:e*s*i.mass*n.mass/(h*h),r.normalize().multiply(o),{force:r}},e.RK4=function(t,e,i,n,s){var r,o,h,u,a,c,p,l,y,f,d,m,g;return u=t,l=e,r=i(u,l,0,s),a=t+.5*l*n,y=e+.5*r*n,o=i(a,y,n/2,s),c=t+.5*y*n,f=e+.5*o*n,h=i(c,f,n/2,s),p=t+f*n,d=e+h*n,m=(u+2*(a+c)+p)/6,g=(l+2*(y+f)+d)/6,{c:t+m*n,d:e+g*n}},e}(e),this.Particle=l,y=function(){function t(){this.count=0,this.particles=[],this.time=0}return t.prototype.add=function(t){return t.id=this.count++,this.particles.push(t),this},t.prototype.remove=function(t){return t&&t.life&&(t.life.complete=!0),this},t.prototype.animate=function(t,e,i){var n,s,r,o,h,u,a,c,p,l;for(this.time++,n=[],p=this.particles,s=o=0,h=p.length;h>o;s=++o)c=p[s],c.life.complete?n.push(s):c.life.active&&c.animate(t,e,i);if(n.length>0){for(l=[],a=0,u=n.length;u>a;a++)r=n[a],l.push(this.particles.splice(r,1));return l}},t}(),this.ParticleSystem=y,p=function(t){function e(){e.__super__.constructor.apply(this,arguments),this.p1=new w(this.x,this.y,this.z),4===arguments.length?(this.z=0,this.p1.set(arguments[2],arguments[3])):6===arguments.length&&this.p1.set(arguments[3],arguments[4],arguments[5])}return D(e,t),e.prototype.to=function(){return this.p1=new w(f.get(arguments)),this},e.prototype.getAt=function(t){return 1===t||"p1"===t?this.p1:this},e.prototype.$getAt=function(t){return new w(this.getAt(t))},e.prototype.relative=function(){return this.p1.add(this),this},e.prototype.$relative=function(){return this.$add(this.p1)},e.prototype.bounds=function(){return new e(this.$min(this.p1)).to(this.$max(this.p1))},e.prototype.withinBounds=function(t,e){var i,n;return e?(i=this.get2D(e),n=this.p1.get2D(e),i.x===n.x?t.y>=Math.min(i.y,n.y)&&t.y<=Math.max(i.y,n.y):i.y===n.y?t.x>=Math.min(i.x,n.x)&&t.x<=Math.max(i.x,n.x):t.x>=Math.min(i.x,n.x)&&t.y>=Math.min(i.y,n.y)&&t.x<=Math.max(i.x,n.x)&&t.y<=Math.max(i.y,n.y)):t.x>=Math.min(this.x,this.p1.x)&&t.y>=Math.min(this.y,this.p1.y)&&t.z>=Math.min(this.z,this.p1.z)&&t.x<=Math.max(this.x,this.p1.x)&&t.y<=Math.max(this.y,this.p1.y)&&t.z<=Math.max(this.z,this.p1.z)},e.prototype.interpolate=function(t,e){var i;return null==e&&(e=!1),i=e?this.$relative():this.p1,new w((1-t)*this.x+t*i.x,(1-t)*this.y+t*i.y,(1-t)*this.z+t*i.z)},e.prototype.midpoint=function(){return this.interpolate(.5)},e.prototype.direction=function(t){return t?this.$subtract(this.p1):this.p1.$subtract(this)},e.prototype.size=function(){return arguments.length>0?(this.p1=this.$add(f.get(arguments)),this):this.p1.$subtract(this).abs()},e.prototype.length=function(t){var e,i,n,s;return null==t&&(t=!0),s=this.z-this.p1.z,n=this.y-this.p1.y,i=this.x-this.p1.x,e=i*i+n*n+s*s,t?Math.sqrt(e):e},e.prototype.collinear=function(t){return(this.p1.x-this.x)*(t.y-this.y)-(t.x-this.x)*(this.p1.y-this.y)},e.prototype.resetBounds=function(){var t;return t=this.$min(this.p1),this.p1.set(this.$max(this.p1)),this.set(t),this},e.prototype.equal=function(t){return null==t&&(t=!1),arguments[0]instanceof e?e.__super__.equal.call(this,arguments[0])&&this.p1.equal(arguments[0].p1):e.__super__.equal.apply(this,arguments)},e.prototype.clone=function(){var t;return t=new e(this),t.to(this.p1.clone()),t},e.prototype.floor=function(){return e.__super__.floor.apply(this,arguments),this.p1.floor()},e.prototype.toString=function(){return"Pair of vectors from ("+this.x+", "+this.y+", "+this.z+") to ("+this.p1.x+", "+this.p1.y+", "+this.p1.z+")"},e.prototype.toArray=function(){return[this,this.p1]},e}(w),this.Pair=p,u=function(t){function e(){e.__super__.constructor.apply(this,arguments)}return D(e,t),e.slope=function(t,e,i){var s,r;return null==i&&(i=n.xy),s=t.get2D(i),r=e.get2D(i),r.x-s.x===0?!1:(r.y-s.y)/(r.x-s.x)},e.intercept=function(t,e,i){var s,r,o,h;return null==i&&(i=n.xy),o=t.get2D(i),h=e.get2D(i),h.x-o.x===0?!1:(r=(h.y-o.y)/(h.x-o.x),s=o.y-r*o.x,{slope:r,yi:s,xi:0===r?!1:-s/r})},e.isPerpendicularLine=function(t,i,s){var r,o;return null==s&&(s=n.xy),r=e.slope(t,t.p1,s),o=e.slope(i,i.p1,s),r===!1?0===o:o===!1?0===r:r*o===-1},e.prototype.slope=function(t){return null==t&&(t=n.xy),e.slope(this,this.p1,t)},e.prototype.intercept=function(t){return null==t&&(t=n.xy),e.intercept(this,this.p1,t)},e.prototype.getPerpendicular=function(t,i,s,r){var o,h,u;return null==i&&(i=10),null==s&&(s=!1),null==r&&(r=n.xy),h=this.direction().normalize().perpendicular(r),u=s?h[1]:h[0],o=new e(this.interpolate(t)),o.to(u.multiply(i).add(o)),o},e.prototype.getDistanceFromPoint=function(t){var e,i;return i=this.$subtract(this.p1),e=new w(-i.y,i.x).normalize(),this.$subtract(t).dot(e)},e.prototype.getPerpendicularFromPoint=function(t,e){var i;return null==e&&(e=!0),i=this.p1.$subtract(this).projection(t.$subtract(this)),e?i.add(this):i},e.prototype.intersectPath=function(t,e){var i,s,r,o,h,u,a;return null==e&&(e=n.xy),i=this.intercept(e),s=t.intercept(e),o=this.get2D(e),r=t.get2D(e),i===!1?s===!1?!1:(a=-s.slope*(r.x-o.x)+r.y,e===n.xy?new w(o.x,a):new w(o.x,a).get2D(e,!0)):s===!1?(a=-i.slope*(o.x-r.x)+o.y,new w(r.x,a)):s.slope!==i.slope?(h=(i.slope*o.x-s.slope*r.x+r.y-o.y)/(i.slope-s.slope),u=i.slope*(h-o.x)+o.y,e===n.xy?new w(h,u):new w(h,u).get2D(e,!0)):i.yi===s.yi?null:!1},e.prototype.intersectLine=function(t,e){var i;return null==e&&(e=n.xy),i=this.intersectPath(t,e),i&&this.withinBounds(i,e)&&t.withinBounds(i,e)?i:null===i?null:!1},e.intersectLines=function(t,e,i){var n,s,r,o,h,u,a;if(null==i&&(i=!0),!t.intersectLine)throw"No intersectLine function found in "+t.toString();a=[];for(n in e)if(h=e[n],s=t.intersectLine(h,i)){if(!i)return!0;if(s.length>0)for(r=0,o=s.length;o>r;r++)u=s[r],a.push(u)}return i?a:!1},e.prototype.intersectGridLine=function(t,e,i){var s,r,o,h;if(null==e&&(e=!1),null==i&&(i=n.xy),s=this.get2D(i),r=this.p1.get2D(i),o=t.get2D(i),h=t.p1.get2D(i),r.x-s.x===0){if(h.y-o.y===0&&b.within(s.x,o.x,h.x)&&(e||b.within(o.y,s.y,r.y)))return new w(s.x,o.y)}else{if(r.y-s.y!==0)return!1;if(h.x-o.x===0&&b.within(s.y,o.y,h.y)&&(e||b.within(o.x,s.x,r.x)))return new w(o.x,s.y)}},e.prototype.subpoints=function(t){var e,i,n,s;for(n=[],s=e=0,i=t;i>=0?i>=e:e>=i;s=i>=0?++e:--e)n.push(this.interpolate(s/t));return n},e.prototype.clone=function(t){return new e(this).to(this.p1)},e}(p),this.Line=u,m=function(t){function i(){i.__super__.constructor.apply(this,arguments),this.center=new w}return D(i,t),i.contain=function(t,e,i){return t.x>=e.x&&t.x<=i.x&&t.y>=e.y&&t.y<=i.y&&t.z>=e.z&&t.z<=i.z},i.prototype.toString=function(){var t;return t=this.size(),"Rectangle x1 "+this.x+", y1 "+this.y+", z1 "+this.z+", x2 "+this.p1.x+", y2 "+this.p1.y+", z2 "+this.p1.z+", width "+t.x+", height "+t.y},i.prototype.toPointSet=function(){var t;return t=this.corners(),new d(this).to([t.topRight,t.bottomRight,t.bottomLeft,t.topLeft])},i.prototype.to=function(t){return this.p1=new w(f.get(arguments)),this.resetBounds(),this.center=this.midpoint(),this},i.prototype.setCenter=function(t){var e;return 0===arguments.length?void(this.center=this.midpoint()):(e=this.size().$divide(2),this.center.set(f.get(arguments)),this.set(this.center.$subtract(e)),this.p1.set(this.center.$add(e)),this)},i.prototype.resizeTo=function(){return this.p1=new w(f.get(arguments)),this.relative(),this.center=this.midpoint(),this},i.prototype.resizeCenterTo=function(){var t;return t=new w(f.get(arguments)).divide(2),this.set(this.center.$subtract(t)),this.p1.set(this.center.$add(t)),this},i.prototype.enclose=function(t){return this.set(this.$min(t)),this.p1.set(this.p1.$max(t.p1)),this.center=this.midpoint(),this},i.prototype.$enclose=function(t){return this.clone().enclose(t)},i.prototype.isEnclosed=function(t){var e,i;return e=this.$subtract(t).multiply(this.p1.$subtract(t.p1)),i=this.size().subtract(t.size()),e.x<=0&&e.y<=0&&e.z<=0&&i.x*i.y>=0},i.prototype.isLarger=function(t){var e,i;return e=this.size(),i=t.size(),e.x*e.y>i.x*i.y},i.prototype.intersectPoint=function(){var t;return t=f.get(arguments),t.x>=this.x&&t.x<=this.p1.x&&t.y>=this.y&&t.y<=this.p1.y&&t.z>=this.z&&t.z<=this.p1.z},i.prototype.intersectPath=function(t,e){var i,n,s,r,o,h;for(null==e&&(e=!0),h=this.sides(),r=[],i=0,n=h.length;n>i;i++)if(o=h[i],s=o.intersectPath(t),s&&this.intersectPoint(s)){if(!e)return!0;r.push(s)}return e?r:!1},i.prototype.intersectLine=function(t,e){var i,n,s,r,o,h,u,a,c;if(null==e&&(e=!0),i=this.intersectPoint(t),n=this.intersectPoint(t.p1),i&&n&&e)return[];if(!i&&!n&&(r=t.bounds(),!this.intersectRectangle(r,!1)))return e?[]:!1;for(c=this.sides(),u=[],s=0,o=c.length;o>s;s++)if(a=c[s],h=t.intersectLine(a)){if(!e)return!0;u.push(h)}return e?u:!1},i.prototype.intersectLines=function(t,e){return null==e&&(e=!0),u.intersectLines(this,t,e)},i.prototype.intersectRectangle=function(t,e){var i,n,s,r,o,h,u,a,c,p,l,y,f,d;if(null==e&&(e=!0),y=this.p1.x>=t.x&&this.x<=t.p1.x,f=this.p1.y>=t.y&&this.y<=t.p1.y,d=this.p1.z>=t.z&&this.z<=t.p1.z,i=y&&f&&d,!e)return i;if(this.isEnclosed(t))return e?[]:!0;if(!i)return[];for(p=this.sides(),l=t.sides(),u=[],n=0,s=p.length;s>n;n++)for(a=p[n],o=0,r=l.length;r>o;o++)c=l[o],h=a.intersectGridLine(c),h&&u.push(h);return u},i.prototype.hasIntersect=function(t,n){return null==n&&(n=!1),t instanceof e?t.intersectLines(this.sides(),n):t instanceof i?this.intersectRectangle(t,n):t instanceof d||t instanceof _?this.intersectLines(t.sides(),n):t instanceof p?this.intersectLine(t,n):t instanceof f?i.contain(t,this,this.p1):n?[]:!1},i.prototype.corners=function(){return{topLeft:new w(Math.min(this.x,this.p1.x),Math.min(this.y,this.p1.y),Math.max(this.z,this.p1.z)),topRight:new w(Math.max(this.x,this.p1.x),Math.min(this.y,this.p1.y),Math.min(this.z,this.p1.z)),bottomLeft:new w(Math.min(this.x,this.p1.x),Math.max(this.y,this.p1.y),Math.max(this.z,this.p1.z)),bottomRight:new w(Math.max(this.x,this.p1.x),Math.max(this.y,this.p1.y),Math.min(this.z,this.p1.z))}},i.prototype.sides=function(){var t;return t=this.corners(),[new u(t.topLeft).to(t.topRight),new u(t.topRight).to(t.bottomRight),new u(t.bottomRight).to(t.bottomLeft),new u(t.bottomLeft).to(t.topLeft)]},i.prototype.quadrants=function(){var t;return t=this.corners(),{topLeft:new this.__proto__.constructor(t.topLeft).to(this.center),topRight:new this.__proto__.constructor(t.topRight).to(this.center),bottomLeft:new this.__proto__.constructor(t.bottomLeft).to(this.center),bottomRight:new this.__proto__.constructor(t.bottomRight).to(this.center)}},i.prototype.clone=function(){var t;return t=new i(this).to(this.p1),t.to(this.p1.clone()),t},i}(p),this.Rectangle=m,h=function(t){function e(){e.__super__.constructor.apply(this,arguments),this.cell={type:"fix-fix",size:new w},this.rows=0,this.columns=0,this.layout=[],this.cellCallback=null}return D(e,t),e.prototype.toString=function(){var t;return t=this.size(),"Grid width "+t.x+", height "+t.y+", columns "+this.columns+", rows "+this.rows+", "+("cell ("+this.cell.size.x+", "+this.cell.size.y+"), type "+this.cell.type)},e.prototype.init=function(t,e,i,n){var s;return null==i&&(i="fix"),null==n&&(n="fix"),s=this.size(),this.cell.type=i+"-"+n,this.rows=e,this.columns=t,"stretch"===i?(this.cell.size.x=s.x/t,this.columns=t):"flex"===i?(this.columns=Math.round(s.x/t),this.cell.size.x=s.x/this.columns):(this.cell.size.x=t,this.columns=Math.floor(s.x/this.cell.size.x)),"stretch"===n?(this.cell.size.y=s.y/e,this.rows=e):"flex"===n?(this.rows=Math.round(s.y/e),this.cell.size.y=s.y/this.rows):(this.cell.size.y=e,this.rows=Math.floor(s.y/this.cell.size.y)),this.layout.length<1&&this.resetLayout(),this},e.prototype.generate=function(t){return"function"==typeof t&&(this.cellCallback=t),this},e.prototype.create=function(){var t,e,i,n,s,r,o,h,u;if(!this.cellCallback)return this;for(t=n=0,h=this.columns;h>=0?h>n:n>h;t=h>=0?++n:--n)for(o=s=0,u=this.rows;u>=0?u>s:s>u;o=u>=0?++s:--s)e=this.cell.size.clone(),r=this.$add(e.$multiply(t,o)),i=this.layout.length>0&&this.layout[0].length>0?1===this.layout[o][t]:!1,this.cellCallback(e,r,o,t,this.cell.type,i);return this},e.prototype.getCellSize=function(){return this.cell.size.clone()},e.prototype.cellToRectangle=function(t,e,i){var n;return null==i&&(i=!1),i||t>=0&&t<this.columns&&e>=0&&e<this.rows?n=new m(this.$add(this.cell.size.$multiply(t,e))).resizeTo(this.cell.size):!1},e.prototype.positionToCell=function(t){var e,i;return i=new w(this._getArgs(arguments)),e=i.$subtract(this).$divide(this.cell.size).floor(),e.max(0,0).min(this.columns-1,this.rows-1),e},e.prototype.resetLayout=function(t){var e,i,n,s,r,o;for(this.layout=[],s=i=0,r=this.rows;r>=0?r>i:i>r;s=r>=0?++i:--i)for(this.layout[s]=[],e=n=0,o=this.columns;o>=0?o>n:n>o;e=o>=0?++n:--n)this.layout[s][e]=0,t&&t(this,s,e);return this},e.prototype.occupy=function(t,e,i,n,s){var r,o,h,u,a,c;if(null==s&&(s=!0),this.rows<=0||this.columns<=0)return this;for(this.layout.length<1&&this.resetLayout(),r=o=0,a=i;a>=0?a>o:o>a;r=a>=0?++o:--o)for(u=h=0,c=n;c>=0?c>h:h>c;u=c>=0?++h:--h)this.layout[Math.min(this.layout.length-1,e+u)][t+r]=s?1:0;return this},e.prototype.canFit=function(t,e,i,n){var s,r,o,h,u,a,c,p,l;for(o=h=a=e,c=Math.min(this.rows,e+n);c>=a?c>h:h>c;o=c>=a?++h:--h)for(r=u=p=t,l=Math.min(this.columns,t+i);l>=p?l>u:u>l;r=l>=p?++u:--u)if(s=this.layout[o][r],null!=s&&s>0)return!1;return!0},e.prototype.fit=function(t,e){var i,n,s,r,o,h,u,a,c,p,l;for(r=Math.min(t,this.columns),h=a=0,p=this.rows;p>=0?p>a:a>p;h=p>=0?++a:--a)for(s=r,u=0,o=c=0,l=this.columns;l>=0?l>c:c>l;o=l>=0?++c:--c)if(n=this.layout[h][o],null!=n&&n>0)u++,s=r;else if(s--,0>=s)return this.occupy(u,h,r,e),i=new m(this.$add(this.cell.size.$multiply(u,h))),i.resizeTo(this.cell.size.$multiply(r,e)),{row:h,column:u,columnSize:r,rowSize:e,bound:i};return!1},e.prototype.neighbors=function(t,e){var i,n,s,r,o;for(o=[[t-1,e-1],[t,e-1],[t+1,e-1],[t+1,e],[t+1,e+1],[t,e+1],[t-1,e+1],[t-1,e]],r=[],i=0,n=o.length;n>i;i++)s=o[i],r.push(s[0]>=0&&s[0]<this.columns&&s[1]>=0&&s[1]<this.rows?new w(s[0],s[1],this.layout[s[1]][s[0]]):!1);return r},e}(m),this.Grid=h,d=function(t){function e(){e.__super__.constructor.apply(this,arguments),this.points=[]}return D(e,t),e.prototype.toString=function(){var t,e,i,n,s;for(s="PointSet [ ",n=this.points,t=0,e=n.length;e>t;t++)i=n[t],s+=i.x+","+i.y+","+i.z+", ";return s+" ]"},e.prototype.toArray=function(){return this.points.slice()},e.prototype.to=function(t){var e,i,n,s;if(arguments.length>0)if(Array.isArray(arguments[0])&&arguments[0].length>0&&"object"==typeof arguments[0][0])for(s=arguments[0],e=0,i=s.length;i>e;e++)n=s[e],this.points.push(new w(n));else this.points.push(new w(f.get(arguments)));return this},e.prototype.getAt=function(t){return this.points[Math.min(this.points.length-1,Math.max(0,t))]},e.prototype.$getAt=function(t){return new w(this.getAt(t))},e.prototype.setAt=function(t,e){return this.points[t]=e,this},e.prototype.count=function(){return this.points.length},e.prototype.connectFromAnchor=function(t){var e,i,n,s;if(arguments.length>0)if(Array.isArray(arguments[0])&&arguments[0].length>0)for(s=arguments[0],e=0,i=s.length;i>e;e++)n=s[e],this.points.push(this.$add(n));else this.points.push(this.$add(f.get(arguments)));return this},e.prototype.disconnect=function(t){return null==t&&(t=-1),this.points=0>t?this.points.slice(0,this.points.length+t):this.points.slice(t+1),this},e.prototype.clear=function(){return this.points=[],this},e.prototype.sides=function(t){var e,i,n,s,r,o;for(null==t&&(t=!0),i=null,o=[],r=this.points,e=0,n=r.length;n>e;e++)s=r[e],i&&o.push(new u(i).to(s)),i=s;return this.points.length>1&&t&&o.push(new u(i).to(this.points[0])),o},e.prototype.angles=function(t){var e,i,s,r,o,h;for(null==t&&(t=n.xy),e=[],i=s=1,r=this.points.length-1;r>s;i=s+=1)o=this.points[i-1].$subtract(this.points[i]),h=this.points[i+1].$subtract(this.points[i]),e.push({p0:this.points[i-1],p1:this.points[i],p2:this.points[i+1],angle:o.angleBetween(h)});return e},e.prototype.bounds=function(){return b.boundingBox(this.points)},e.prototype.centroid=function(){return b.centroid(this.points)},e.prototype.convexHull=function(t){var e,i,n,s,r;if(null==t&&(t=!0),this.points.length<3)return[];for(t?(r=this.points.slice(),r.sort(function(t,e){return t.x-e.x})):r=this.points,n=function(t,e,i){return(e.x-t.x)*(i.y-t.y)-(i.x-t.x)*(e.y-t.y)>0},e=[],n(r[0],r[1],r[2])?(e.push(r[0]),e.push(r[1])):(e.push(r[1]),e.push(r[0])),e.unshift(r[2]),e.push(r[2]),i=3;i<r.length;)if(s=r[i],n(s,e[0],e[1])&&n(e[e.length-2],e[e.length-1],s))i++;else{for(;!n(e[e.length-2],e[e.length-1],s);)e.pop();for(e.push(s);!n(e[0],e[1],s);)e.shift();e.unshift(s),i++}return e},e.prototype.clone=function(){
return new e(this).to(b.clonePoints(this.points))},e}(w),this.PointSet=d,s=function(t){function e(){e.__super__.constructor.apply(this,arguments),this.is3D=!1}return D(e,t),e.prototype._getSteps=function(t){var e,i,n,s,r;for(r=[],n=e=0,i=t;i>=e;n=e+=1)s=n/t,r.push([s,s*s,s*s*s]);return r},e.prototype.controlPoints=function(t,e){var i,n,s,r,o;return null==t&&(t=0),null==e&&(e=!1),i=function(t){return function(e){var i;return i=e<t.points.length-1?e:t.points.length-1}}(this),n=this.points[t],null==n.x?!1:(t=e?t:t+1,s=this.points[i(t++)],r=this.points[i(t++)],o=this.points[i(t++)],{p0:n,p1:s,p2:r,p3:o})},e.prototype.catmullRom=function(t){var e,i,n,s,r,o,h,u,a;if(null==t&&(t=10),this.points.length<2)return[];for(o=[],a=this._getSteps(t),e=this.controlPoints(0,!0),i=n=0,h=t;h>=n;i=n+=1)o.push(this.catmullRomPoint(a[i],e));for(s=0;s<this.points.length-2;)if(e=this.controlPoints(s)){for(i=r=0,u=t;u>=r;i=r+=1)o.push(this.catmullRomPoint(a[i],e));s++}return o},e.prototype.catmullRomPoint=function(t,e){var i,n,s,r,o,h,u,a,c,p;return o=t[0],h=t[1],u=t[2],i=-.5*u+h-.5*o,n=1.5*u-2.5*h+1,s=-1.5*u+2*h+.5*o,r=.5*u-.5*h,a=i*e.p0.x+n*e.p1.x+s*e.p2.x+r*e.p3.x,c=i*e.p0.y+n*e.p1.y+s*e.p2.y+r*e.p3.y,p=this.is3D?i*e.p0.z+n*e.p1.z+s*e.p2.z+r*e.p3.z:0,new f(a,c,p)},e.prototype.cardinal=function(t,e){var i,n,s,r,o,h,u,a,c;if(null==t&&(t=10),null==e&&(e=.5),this.points.length<2)return[];for(h=[],c=this._getSteps(t),i=this.controlPoints(0,!0),n=s=0,u=t;u>=s;n=s+=1)h.push(this.cardinalPoint(c[n],i,e));for(r=0;r<this.points.length-2;)if(i=this.controlPoints(r)){for(n=o=0,a=t;a>=o;n=o+=1)h.push(this.cardinalPoint(c[n],i,e));r++}return h},e.prototype.cardinalPoint=function(t,e,i){var n,s,r,o,h,u,a,c,p,l,y,d;return null==i&&(i=.5),a=t[0],c=t[1],p=t[2],n=i*(-1*p+2*c-a),s=i*(-1*p+c),r=2*p-3*c+1,o=i*(p-2*c+a),h=-2*p+3*c,u=i*(p-c),l=e.p0.x*n+e.p1.x*s+r*e.p1.x+e.p2.x*o+h*e.p2.x+e.p3.x*u,y=e.p0.y*n+e.p1.y*s+r*e.p1.y+e.p2.y*o+h*e.p2.y+e.p3.y*u,d=this.is3D?e.p0.z*n+e.p1.z*s+r*e.p1.z+e.p2.z*o+h*e.p2.z+e.p3.z*u:0,new f(l,y,d)},e.prototype.bezier=function(t){var e,i,n,s,r,o,h;if(null==t&&(t=10),this.points.length<4)return[];for(r=[],h=this._getSteps(t),s=0;s<=this.points.length-3;)if(e=this.controlPoints(s)){for(i=n=0,o=t;o>=n;i=n+=1)r.push(this.bezierPoint(h[i],e));s+=3}return r},e.prototype.bezierPoint=function(t,e){var i,n,s,r,o,h,u,a,c,p;return o=t[0],h=t[1],u=t[2],i=-1*u+3*h-3*o+1,n=3*u-6*h+3*o,s=-3*u+3*h,r=u,a=i*e.p0.x+n*e.p1.x+s*e.p2.x+r*e.p3.x,c=i*e.p0.y+n*e.p1.y+s*e.p2.y+r*e.p3.y,p=this.is3D?i*e.p0.z+n*e.p1.z+s*e.p2.z+r*e.p3.z:0,new f(a,c,p)},e.prototype.bspline=function(t,e){var i,n,s,r,o,h,u,a,c;if(null==t&&(t=10),null==e&&(e=!1),this.points.length<2)return[];for(h=[],c=this._getSteps(t),r=0;r<this.points.length-2;)if(i=this.controlPoints(r)){if(e)for(n=o=0,a=t;a>=o;n=o+=1)h.push(this.bsplineTensionPoint(c[n],i,e));else for(n=s=0,u=t;u>=s;n=s+=1)h.push(this.bsplinePoint(c[n],i));r++}return h},e.prototype.bsplinePoint=function(t,e){var i,n,s,r,o,h,u,a,c,p;return o=t[0],h=t[1],u=t[2],i=-.16666666666*u+.5*h-.5*o+.16666666666,n=.5*u-h+.66666666666,s=-.5*u+.5*h+.5*o+.16666666666,r=.16666666666*u,a=i*e.p0.x+n*e.p1.x+s*e.p2.x+r*e.p3.x,c=i*e.p0.y+n*e.p1.y+s*e.p2.y+r*e.p3.y,p=this.is3D?i*e.p0.z+n*e.p1.z+s*e.p2.z+r*e.p3.z:0,new f(a,c,p)},e.prototype.bsplineTensionPoint=function(t,e,i){var n,s,r,o,h,u,a,c,p,l,y,d;return null==i&&(i=1),a=t[0],c=t[1],p=t[2],n=i*(-.16666666666*p+.5*c-.5*a+.16666666666),s=i*(-1.5*p+2*c-.33333333333),r=2*p-3*c+1,o=i*(1.5*p-2.5*c+.5*a+.16666666666),h=-2*p+3*c,u=.16666666666*i*p,l=n*e.p0.x+s*e.p1.x+r*e.p1.x+o*e.p2.x+h*e.p2.x+u*e.p3.x,y=n*e.p0.y+s*e.p1.y+r*e.p1.y+o*e.p2.y+h*e.p2.y+u*e.p3.y,d=this.is3D?n*e.p0.z+s*e.p1.z+r*e.p1.y+o*e.p2.z+h*e.p2.z+u*e.p3.z:0,new f(l,y,d)},e}(d),this.Curve=s,_=function(t){function i(){i.__super__.constructor.apply(this,arguments),this.p1=new w(this.x-1,this.y-1,this.z),this.p2=new w(this.x+1,this.y+1,this.z)}return D(i,t),i.prototype.to=function(t){return arguments.length>0&&("object"==typeof arguments[0]&&2===arguments.length?(this.p1.set(arguments[0]),this.p2.set(arguments[1])):arguments.length<6?(this.p1.set([arguments[0],arguments[1]]),this.p2.set([arguments[2],arguments[3]])):(this.p1.set([arguments[0],arguments[1],arguments[2]]),this.p2.set([arguments[3],arguments[4],arguments[5]]))),this},i.prototype.toArray=function(){return[this,this.p1,this.p2]},i.prototype.toString=function(){return"Triangle ("+this.x+", "+this.y+", "+this.z+"), ("+this.p1.x+", "+this.p1.y+", "+this.p1.z+"), ("+this.p2.x+", "+this.p2.y+", "+this.p2.z+")"},i.prototype.getAt=function(t){return 1===t||"p1"===t?this.p1:2===t||"p2"===t?this.p2:this},i.prototype.$getAt=function(t){return new w(this.getAt(t))},i.prototype.toPointSet=function(){var t;return t=new w(this),new d(t).to([t,this.p1,this.p2])},i.prototype.sides=function(){return[new u(this).to(this.p1),new u(this.p1).to(this.p2),new u(this.p2).to(this)]},i.prototype.angles=function(t){var e;return null==t&&(t=n.xy),e=[this.p2.$subtract(this).angleBetween(this.p1.$subtract(this),t),this.$subtract(this.p1).angleBetween(this.p2.$subtract(this.p1),t)],e.push(Math.PI-e[0]-e[1]),e},i.prototype.medial=function(){var t,e,n;return n=this.sides(),t=function(){var t,i,s;for(s=[],t=0,i=n.length;i>t;t++)e=n[t],s.push(e.midpoint());return s}(),new i(t[0]).to(t[1],t[2])},i.prototype.perimeter=function(){var t,e;return e=this.sides(),t=[e[0].length(),e[1].length(),e[2].length()],{sides:e,value:t[0]+t[1]+t[2],lengths:t}},i.prototype.area=function(){var t,e;return e=this.perimeter(),t=e.value/2,{value:Math.sqrt(t*(t-e.lengths[0])*(t-e.lengths[1])*(t-e.lengths[2])),perimeter:e}},i.prototype.oppositeSide=function(t){return"p1"===t?new u(this).to(this.p2):"p2"===t?new u(this).to(this.p1):new u(this.p1).to(this.p2)},i.prototype.adjacentSides=function(t){return"p1"===t?[new u(this.p1).to(this),new u(this.p1).to(this.p2)]:"p2"===t?[new u(this.p2).to(this),new u(this.p2).to(this.p1)]:[new u(this).to(this.p1),new u(this).to(this.p2)]},i.prototype.bisector=function(t,e,i){var n,s,r;return null==e&&(e=!1),null==i&&(i=100),n=this.adjacentSides(t),r=new w(n[0]),n[0].moveTo(0,0),n[1].moveTo(0,0),s=n[0].p1.bisect(n[1].p1),e?new u(r).to(s.multiply(i).add(r)):s},i.prototype.altitude=function(t){return"p1"===t||"p2"===t?new u(this[t]).to(this.oppositeSide(t).getPerpendicularFromPoint(this[t])):new u(this).to(this.oppositeSide().getPerpendicularFromPoint(this))},i.prototype.centroid=function(){var t,e,i;return t=this.$divide(3),e=this.p1.$divide(3),i=this.p2.$divide(3),new w(t.x+e.x+i.x,t.y+e.y+i.y,t.z+e.z+i.z)},i.prototype.orthocenter=function(){var t,e;return t=this.altitude(),e=this.altitude("p1"),t.intersectPath(e,n.xyz)},i.prototype.incenter=function(){var t,e;return t=this.bisector("p0",!0),e=this.bisector("p1",!0),t.intersectPath(e,n.xyz)},i.prototype.incircle=function(){var t,i,n;return i=this.incenter(),t=this.area(),n=2*t.value/t.perimeter.value,new e(i).setRadius(n)},i.prototype.circumcenter=function(){var t,e;return t=this.medial(),e=[new u(t).to(this.$subtract(t).perpendicular()[0].$add(t)),new u(t.p1).to(this.p1.$subtract(t.p1).perpendicular()[0].$add(t.p1)),new u(t.p2).to(this.p2.$subtract(t.p2).perpendicular()[0].$add(t.p2))],{center:e[0].intersectPath(e[1],n.xyz),bisectors:e}},i.prototype.circumcircle=function(){var t,i;return t=this.circumcenter(),i=this.magnitude(t.center),new e(t.center).setRadius(i)},i.prototype.intersectPoint=function(t){var e,i,n;return n=this.sides(),e=function(){var e,s,r;for(r=[],e=0,s=n.length;s>e;e++)i=n[e],r.push(i.collinear(t)>0);return r}(),e[0]===e[1]&&e[1]===e[2]},i.prototype.intersectPath=function(t,e,i){var s,r,o,h,u,a;for(null==e&&(e=!0),null==i&&(i=n.xy),a=this.sides(),h=[],s=0,r=a.length;r>s;s++)if(u=a[s],o=u.intersectPath(t),o&&u.withinBounds(o,i)){if(!e)return!0;h.push(o)}return e?h:!1},i.prototype.intersectLine=function(t,e,i){var s,r,o,h,u;for(null==e&&(e=!0),null==i&&(i=n.xy),s=this.intersectPath(t,!0,i),u=[],r=0,o=s.length;o>r;r++)if(h=s[r],t.withinBounds(h)){if(!e)return!0;u.push(h)}return e?u:!1},i.prototype.intersectLines=function(t,e){return null==e&&(e=!0),u.intersectLines(this,t,e)},i.prototype.intersectPath3D=function(t,e){var i,s,r,o,h,u,a,c,p,l,y;return r=this.p1.$subtract(this),o=this.p2.$subtract(this),s=t.direction().normalize(),u=s.cross(o),i=r.dot(u),i>-n.epsilon&&i<n.epsilon?!1:(h=1/i,p=t.$subtract(this),l=p.dot(u)*h,0>l||l>1?!1:(a=p.cross(r),y=s.dot(a)*h,0>y||y>1?!1:(c=o.dot(a)*h,c>n.epsilon?e?[l,y,c]:!0:!1)))},i.prototype.intersectRectangle=function(t,e){return null==e&&(e=!0),t.intersectLines(this.sides(),e)},i.prototype.intersectCircle=function(t,e){return null==e&&(e=!0),t.intersectLines(this.sides(),e)},i.prototype.intersectTriangle=function(t,e){return null==e&&(e=!0),t.intersectLines(this.sides(),e)},i.prototype.clone=function(){return new i(this).to(this.p1,this.p2)},i}(w),this.Triangle=_}.call(Pt);
